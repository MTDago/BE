<h2>Your order</h2>

<table>
<tr>
  <th>Title</th>
  <th>Seller</th>
  <th>Price</th>
</tr>
<tr>
  <td><%= @listing.title %></td>
  <td><%= @profile.user_name %></td>
  <td><%= number_to_currency(@listing.price) %></td>
  <td><%= params[:duration]  %>
</tr>
<tr>
  <th colspan="2">Total</th>
  <td><%= number_to_currency() %></td>
</tr>
</table>

<%= form_with(model: order, local: true) do |form| %>

  <%= form.hidden_field :title, value: @order.title %>
  <%= form.hidden_field :user, value: @order.user  %>
  <%= form.hidden_field :ammount, @order.ammount %>
  <%= form.hidden_field :seller, @order.seller %>

  <div class="actions" id="order_button">
    <%= form.submit %>
  </div>
<% end %>


<script src="https://js.stripe.com/v3/"></script>
<script>
    var stripe = Stripe(ENV['STRIPE_API_KEY_PK']);
    var orderButton = document.getElementById('order_button');

    function checkout(){    
        stripe.redirectToCheckout({
        sessionId: '<%= @stripe_session.id %>',
        }).then(function (result) {
        // If `redirectToCheckout` fails due to a browser or network
        // error, display the localized error message to your customer
        // using `result.error.message`.
        });
    }

    orderButton.addEventListener('submit', checkout);

</script>